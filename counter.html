<!doctype html> 
<html> 
<head> 
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /> 
	</head> 
<body> 

<style> 
body { 
	background-color : #b5b5b5; 
	} 

button { 
	font-size : 30pt; 
	padding : 10pt; 
	vertical-align : bottom; 
	} 
button.de { 
	padding-top : 0; 
	padding-bottom : 0; 
	} 
div#counted { 
	font-size : 30pt; 
	text-align : center; 
	} 
	</style> 
<div id="buttonBracket" > 
	<button id="counter" > count 123 </button><button id="decounter" class="de" >-</button>
	<button id="untilFill" > / 999 fill </button><button id="deFiller" class="de" >-</button>
	</div> 
<div id="counted" > 
	123
	</div> 

<script> 

{ 
/// 

let counter = $` #counter ` 
let decounter = $` #decounter ` 
let untilFill = $` #untilFill ` 
let deFiller = $` #deFiller ` 
let counted = $` #counted ` 

let histories = [] 

counterExcute( new class { 
	counter = counter 
	counterForm = counterForm 
	button = counter 
	action = n => n + 1 
	} ) 
counterExcute( new class { 
	counter = counter 
	counterForm = counterForm 
	button = decounter 
	action = n => n - 1 
	} ) 
counterExcute( new class { 
	counter = untilFill 
	counterForm = fillForm 
	button = untilFill 
	action = n => n + 1 
	} ) 
counterExcute( new class { 
	counter = untilFill 
	counterForm = fillForm 
	button = deFiller 
	action = n => n - 1 
	} ) 

counter .click() 
histories[ 0 ][ 1 ] = 0 // reset point 

// .. functions .. 

function counterForm( n ) { 
	return `count ${ n }` 
	} 
function fillForm( n ) { 
	return `/ ${ n } fill` 
	} 

function counterExcute({ 
		  counter 
		, counterForm 
		, button 
		, action 
		}) { 
	let remainTime = 1000 * 5 
		// ms seconds minutes 
	
	button .onclick = evt => { 
		let count = doCounterForm({ counter, counterForm, action }) 
		
		let now = [ count, new Date ] 
		histories .push( now ) 
		console .log( now, histories .length ) 
		
		let [, lastTime ] = last( histories ) 
		let { length } = histories 
		
		for ( let i = length - 1; i >= 0; i -= 1 ) { // trace back from last 
			let [ lastCount, iTime ] = histories[ i ] 
			let gab = lastTime - iTime 
			let countDiff = count - lastCount 
			
			lastTime = iTime 
			console .log({ lastCount, iTime, gab }) 
			counted .innerHTML = [ `${ countDiff < 0 ? '' : '+' }${ countDiff }`, gab ] 
			if ( gab > remainTime ) { 
				console .log( gab ) 
				break 
				} 
			} 
		console .log({ lastTime }) 
		
		} // -- button onclick() 
	} // -- counterExcute() 

function last( a ) { 
	let { length } = a 
	return a[ length - 1 ] 
	} 

function doCounterForm({ counter, counterForm, action }) { 
	let { innerText } = counter 
	let [ countText ] = innerText .match( /\d+/ ) 
	let count = + countText 
	let next = action( count ) 
	let nextText = counterForm( next ?? count ) 
	
	counter .innerText = nextText 
	
	return count 
	} // -- doCounterForm() 

function $( q ) { return document .querySelector( q ) } 

/// 
} 
	</script> 

	</body> 
	</html> 